// ====================================================
//      Routes API: Vulnerability Report
// ====================================================

const express = require('express');
const reportController = require('../controllers/vulnerabilityReport');
const { authenticate, verifiedAdminRol, verifiedProgramPermission, verifiedHackerRol, verifiedAdminHacker } = require('../middlewares/auth.js');
const api = express.Router();

// ==========================================
// Todos los reportes de vulnerabilidad
// ==========================================
api.get('/all', [authenticate, verifiedAdminRol], reportController.getVulnerabilityReports);

// ========================================================
// Todos los reportes de vulnerabilidades por estatus
// ========================================================
api.get('/all/:status', [authenticate, verifiedAdminRol], reportController.getVulnerabilityReportsByStatus);

// ======================================
// Un reporte de vulnerabilidad por id
// ======================================
api.get('/:id', authenticate, reportController.getVulnerabilityReportById);

// =================================================
// Un reporte de vulnerabilidad por id para el inbox
// =================================================
api.get('/:id/inbox/message', authenticate, reportController.getInboxByReportId);

// ============================================
// Reportes de vulnerabilidad por approved
// ============================================
api.get('/approved/:approved', [authenticate, verifiedAdminHacker], reportController.getVulnerabilityReportsByApproved);

// ============================================
// Reportes de vulnerabilidad por program id
// ============================================
api.get('/program/:programId', [authenticate, verifiedProgramPermission], reportController.getVulnerabilityReportsByProgramId);

// ============================================
// Reportes de vulnerabilidad por hacker id
// ============================================
api.get('/hacker/:hackerId', [authenticate, verifiedAdminHacker], reportController.getVulnerabilityReportsByHackerId);

// ============================================
// Reportes de vulnerabilidad por business id
// ============================================
api.get('/business/:businessId', [authenticate, verifiedProgramPermission], reportController.getVulnerabilityReportsByBusinessId);

// ============================================================
// Reportes de vulnerabilidad por tipo de vulnerabilidad id
// ============================================================
api.get('/vulnerabilityType/:vulnerabilityTypeId', [authenticate, verifiedAdminRol], reportController.getVulnerabilityReportsByVulnerabilityTypeId);

// ============================================================
// Reportes de vulnerabilidad de programas p√∫blicos
// ============================================================
api.get('/all/programs/publics', authenticate, reportController.getVulnerabilityReportsByProgramPublics);

// =======================================
// Crear nuevo reporte de vulnerabilidad
// =======================================
api.post('/save', [authenticate, verifiedHackerRol], reportController.saveVulnerabilityReport);

// =======================================
// Actualizar reporte de vulnerabilidad
// =======================================
api.put('/:reportId', [authenticate, verifiedHackerRol], reportController.updateVulnerabilityReport);

// =======================================
// Actualizar archivo de vulnerabilidad
// =======================================
api.put('/:reportId/file', [authenticate, verifiedHackerRol], reportController.updateFileVulnerabilityReport);

// =================================================
// Actualizar status de reporte de vulnerabilidad
// =================================================
api.put('/:id/status', [authenticate, verifiedAdminRol], reportController.updateVulnerabilityReportStatus);

// =================================================
// Aprobar reporte de vulnerabilidad
// =================================================
api.put('/:id/approved', [authenticate, verifiedAdminRol], reportController.approveVulnerabilityReportById);

// =================================================
// Rechazar reporte de vulnerabilidad
// =================================================
api.put('/:id/reject', [authenticate, verifiedAdminRol], reportController.rejectVulnerabilityReportById);

// =================================================
// Agregar comentario a reporte
// =================================================
api.post('/:id/save-comment', authenticate, reportController.saveComment);

// =================================================
// Agregar paso a reporte
// =================================================
api.post('/:reportId/save-step', [authenticate, verifiedHackerRol], reportController.saveStep);

// =================================================
// Editar paso a reporte
// =================================================
api.put('/step/:stepId', [authenticate, verifiedHackerRol], reportController.editStep);

// =================================================
// Eliminar paso a reporte
// =================================================
api.delete('/step/:stepId', [authenticate, verifiedHackerRol], reportController.deleteStep);

module.exports = api;